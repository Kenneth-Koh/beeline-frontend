<ion-view id="pg_kickstarter_instant" view-title="Create a new Crowdstart!"
    hide-back-button="false" can-swipe-back="false">

  <ion-nav-buttons side="right">
    <button class="button button-clear" ui-sref="tabs.crowdstart">
       <i class="icon ion-ios-close-outline"></i>
    </button>
  </ion-nav-buttons>

  <ion-content class="has-header">
    <div class="card">
      <div class="item item-divider">
        Checklist
      </div>
      <div class="item item-text-wrap">
        <ol style="list-style-type: decimal">
          <li>Register with your phone number</li>
          <li>Add your credit card information</li>
          <li>Create the crowdstart!</li>
        </ol>
      </div>
    </div>

    <div class="card" ng-if="!routePreview">
      <div class="item item-divider">
        Route to crowdstart
      </div>
      <div class="item text-center" ng-if="routePreview === null">
        <ion-spinner></ion-spinner>
      </div>
      <div class="item item-text-wrap text-center" ng-if="routePreview === false">
        There was an error processing the crowdstart route
      </div>
    </div>

    <div class="card" ng-if-start="routePreview">
      <div class="item item-divider">
        Route to crowdstart
      </div>
      <div class="item item-text-wrap">
        <ol style="list-style-type: decimal">
          <li ng-repeat="tripStop in routePreview.trips[0].tripStops">
            ({{ tripStop.time | date:'h:mm a':'+0800' }})
            {{ tripStop.stop.description }}
          </li>
        </ol>
      </div>
    </div>

    <div class="card">
      <div class="item item-divider">
        Register with your phone number
      </div>
      <div class="item item-text-wrap" ng-if="user">
        ✔ You are already registered as {{user.telephone}}
      </div>

      <div class="item text-center" ng-if="!user">
        <button class="button button-positive" ng-click="login()">
          Log in
        </button>
      </div>
    </div>

    <div class="card" ng-if="user">
      <div class="item item-divider">
        Add your credit card information
      </div>
      <div ng-if="user">
        <div class="item item-text-wrap" ng-if="hasCreditCard">
          ✔ You have already provided us your credit card information
          (xxxx {{user.savedPaymentInfo.sources.data[0].last4}}).
        </div>
        <div class="text-center" ng-if="!hasCreditCard">
          <button class="button button-positive" ng-click="addCreditCard()">
            Add Payment Details
          </button>
        </div>
      </div>
      <div ng-if="!user">
        <div class="item item-text-wrap">
          You need to complete the previous step first
        </div>
      </div>
    </div>

    <div class="card" ng-if-end>
      <div class="item item-divider">
        Create the crowdstart
      </div>
      <div ng-if="!(user && hasCreditCard)">
        <div class="item item-text-wrap">
          You need to complete the previous step first
        </div>
      </div>
      <div ng-if="user && hasCreditCard">
        <div class="item item-text-wrap">
          <kickstart-info
            route="routePreview"
            pass-hide="true"
            preorder-hide="true"
          ></kickstart-info>
        </div>
        <div class="item item-divider">
          Instant Crowdstart Policy
        </div>
        <div class="item item-text-wrap features">
          Please be aware that, because of the automated nature of Instant Crowdstart:
          <ul>
            <li>
              Prices, timings and stops, and required number of crowdstarters are
              tentative. They may change due to:
              <ul>
                <li>Prevailing land transport regulations</li>
                <li>Market conditions</li>
                <li>Logistical difficulties</li>
              </ul>
            </li>
            <li>
              Campaign duration may be extended if there are new participants.
            </li>
            <li>
              We will inform you prior to making any changes to the pricing or stops.
              You may contact us if you would like to withdraw from the campaign after the change.
            </li>
          </ul>

          All that said, the more crowdstarters there are, the more
          likely your route will be crowdstarted, and the lower
          the final price. Therefore do encourage your friends, colleagues
          and family to join the campaign!
        </div>
        <ion-checkbox ng-model="agreeCrowdstartTerms">
          I have read and agreed to the terms and conditions
        </ion-checkbox>
        <button class="button button-positive primary-button" ng-click="createCrowdstart()"
            ng-disabled="!agreeCrowdstartTerms">
          Sign me up, Baby!
        </button>
      </div>
    </div>
  </ion-content>
</ion-view>
