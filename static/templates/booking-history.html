<ion-view title="Payment History" class="booking-history">
  <ion-content>
    <ion-list>
      <div class="item text-center" ng-if="transactions.length === 0">
        You have no bookings in our records.
      </div>
      <div class="card" ng-repeat="transaction in transactions track by transaction.id" ng-if="transaction.committed && transaction.itemDetail && transaction.totalAmount > 0">

        <!-- TRANSACTION HEADER -->
        <div class="item item-divider transaction-header transaction-row">
          <div class="col-left item-note table-cell">
            <div ng-if="transaction.type !== 'refundPayment'" class="balanced transaction-button">Paid</div>
            <div ng-if="transaction.type === 'refundPayment'" class="refund transaction-button">Refund</div>
          </div>
          <div class="table-cell transaction-number">Txn #{{transaction.id}}</div>
          <div class="table-cell transaction-cost" ng-if="transaction.totalAmount">${{ transaction.totalAmount | number: 2 }}</div>
        </div>

        <!-- TRANSACTION DETAILS -->
        <div class="item transaction-details">

          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <!-- Transaction Datetime -->
          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <div class="transaction-row">
            <div class="col-left row-header table-cell">
              Txn Date
            </div>

            <div class="row-content table-cell item-text-wrap">
              {{ transaction.createdAt | formatDateddMMMYYYY }} {{ transaction.createdAt | formatTime }}
            </div>
          </div>

          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <!-- Payment Details -->
          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <div class="transaction-row" ng-repeat="payment in transaction.itemsByType.payment track by payment.id" ng-if="payment.payment.data.source.funding === 'credit'">
              <div class="col-left row-header table-cell">
                Card
              </div>

              <div class="row-content table-cell item-text-wrap">
                **** **** **** {{payment.payment.data.source.last4}}
              </div>
          </div>

          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <!-- Route details -->
          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <div class="transaction-row">
            <div class="col-left row-header table-cell">
              Route
            </div>

            <div class="row-content table-cell item-text-wrap">
              {{ transaction.route.label }} by {{ transaction.route.transportCompany.name }}
            </div>
          </div>

          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <!-- Item details -->
          <!-- ----------------------------------------------------- -->
          <!-- ----------------------------------------------------- -->
          <div class="transaction-row" ng-if="transaction.itemDetail">
            <div class="col-left row-header table-cell">
              Item
            </div>

            <div class="row-content table-cell item-text-wrap">
              {{ transaction.itemDetail }}
            </div>
          </div>
        </div>
      </div>
    </ion-list>

    <ion-infinite-scroll on-infinite="loadMore()" ng-if="hasMoreData || routesById === {}">
    </ion-infinite-scroll>

  </ion-content>
</ion-view>
