
<!--
Create tabs with an icon and label, using the tabs-positive style.
Each tab's child <ion-nav-view> directive will have its own
navigation history that also transitions its views in and out.
-->
<ion-view id="tabs">
  <ion-tabs class="tabs-icon-top tabs-calm">

    <ion-tab title="Routes"
             class="nav-text nav-routes"
             href="#/tabs/routes">
     <ion-nav-bar class="bar-royal">
       <ion-nav-back-button></ion-nav-back-button>
     </ion-nav-bar>
      <ion-nav-view name="tab-routes"></ion-nav-view>
    </ion-tab>

    <ion-tab title="Trips"
            class="nav-text nav-tickets"
             href="#/tabs/tickets">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button></ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-tickets"></ion-nav-view>
    </ion-tab>

    <!-- this tab is hidden too -->
    <ion-tab title="Crowdstart"
            class="nav-text nav-kickstarter"
             href="#/tabs/crowdstart"
             hidden="false">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button></ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-crowdstart"></ion-nav-view>
    </ion-tab>

    <ion-tab title="Settings"
             class="nav-text nav-settings"
             href="#/tabs/settings">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button>Back</ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-settings"></ion-nav-view>
    </ion-tab>

    <!-- This tab is hidden -->
    <ion-tab title="Booking"
             href="#/tabs/booking"
             hidden="true">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button>
        </ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-booking"></ion-nav-view>
    </ion-tab>

    <ion-tab title="Lite"
             href="#/tabs/lite"
             hidden="true">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button>
        </ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-lite"></ion-nav-view>
    </ion-tab>

    <ion-tab title="Search"
             href="#/tabs/search"
             hidden="true">
      <ion-nav-bar class="bar-royal">
        <ion-nav-back-button>
        </ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view name="tab-search"></ion-nav-view>
    </ion-tab>
  </ion-tabs>

  <ui-gmap-google-map
    center="map.center"
    pan="true"
    zoom="map.zoom"
    bounds="map.bounds"
    dragging="map.dragging"
    control="map.control"
    options="map.options"
    data-tap-disabled="true"
  >
    <my-location></my-location>
    <map-poly-route route-path="mapObject.routePath"></map-poly-route>
    <!-- for lite route -->
    <ui-gmap-marker
      ng-repeat="stop in mapObject.stops"
      idKey="stop.id"
      coords="stop.coordinates"
      options="stop.canBoard ? map.markerOptions.boardMarker : map.markerOptions.alightMarker"
      click="applyTapBoard(stop)"
    ></ui-gmap-marker>
    <ui-gmap-window ng-if="disp.popupStop"
                    coords="disp.popupStop.coordinates"
                    show="disp.popupStop"
                    closeClick="closeWindow">
      <div class="popUpStopSelect">
        <b ng-if="disp.popupStop.time && !Array.isArray(disp.popupStop.time)">{{disp.popupStop.time | formatTime }}</b><br/>
        <b ng-if="disp.popupStop.time && Array.isArray(disp.popupStop.time)">{{disp.popupStop.time | formatTimeArray }}<br/></b>
        {{disp.popupStop.description}}<br/>{{disp.popupStop.road}}<br/>
      </div>
    </ui-gmap-window>
    <ui-gmap-marker idkey="'boardstop'"
                    ng-if="mapObject.boardStop.stop"
                    coords="mapObject.boardStop.stop.coordinates"
                    options="map.markerOptions.startMarker"></ui-gmap-marker>
    <ui-gmap-marker idkey="'alightstop'"
                    ng-if="mapObject.alightStop.stop"
                    coords="mapObject.alightStop.stop.coordinates"
                    options="map.markerOptions.endMarker"></ui-gmap-marker>
    <ui-gmap-marker ng-if="mapObject.chosenStop"
                    idkey="'selectedStopPin'"
                    coords="mapObject.chosenStop.coordinates"
                    options="mapObject.chosenStop.canBoard ? map.markerOptions.startMarker : map.markerOptions.endMarker">
    </ui-gmap-marker>
    <map-bus-icon ng-repeat="recentPings in mapObject.allRecentPings track by $index"
                  idkey="'bus-icon' + $index"
                  ng-if="recentPings.isRecent"
                  pings="recentPings.pings"
                  overlay="$index + 1"></map-bus-icon>
    <!-- TODO: we cannot do this as whole map is stucked once return -->
    <!-- <map-bus-poly-route route="mapObject.route"
                        available-trips="mapObject.todayTrips">
    </map-bus-poly-route> -->
    <!-- <map-bus-stops available-trips="mapObject.nextTrips"
                   is-lite-frequent="mapObject.route['tags'].includes('lite-frequent')">
    </map-bus-stops> -->
  </ui-gmap-google-map>

</ion-view>
