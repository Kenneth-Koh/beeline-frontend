<ion-modal-view class="ticket-detail page-with-map">

  <ion-header-bar class="bar-royal bar bar-header">
    <h1 class="title">Ticket {{ticket.boardStop.time | date:'d MMM y' : '+0800'}}</h1>
    <button class="button button-clear icon ion-ios-close-outline" ng-click="modal.hide()">
    </button>
  </ion-header-bar>

  <ion-content>
  <div class="trip-info">
    <div class="map map-area">
      <div ng-if="modalMap.center && false">
        {{modalMap.center}}
        {{modalMap.bounds}}
      </div>
      <ui-gmap-google-map
        ng-if="modalMap.center"
        center="modalMap.center"
        pan="true"
        zoom="modalMap.zoom"
        bounds="modalMap.bounds"
        dragging="modalMap.dragging"
        control="modalMap.control"
        options="modalMap.options"
        data-tap-disabled="true"
      >
        <my-location></my-location>
        <map-poly-route route-path="mapObject.routePath"></map-poly-route>
        <!-- for lite route -->
        <ui-gmap-marker
          ng-repeat="stop in mapObject.stops"
          idKey="stop.id"
          coords="stop.coordinates"
          options="stop.canBoard ? modalMap.markerOptions.boardMarker : modalMap.markerOptions.alightMarker"
        ></ui-gmap-marker>
        <ui-gmap-marker idkey="'boardstop'"
                        ng-if="mapObject.boardStop.stop"
                        coords="mapObject.boardStop.stop.coordinates"
                        options="modalMap.markerOptions.startMarker"></ui-gmap-marker>
        <ui-gmap-marker idkey="'alightstop'"
                        ng-if="mapObject.alightStop.stop"
                        coords="mapObject.alightStop.stop.coordinates"
                        options="modalMap.markerOptions.endMarker"></ui-gmap-marker>
        <map-bus-icon ng-repeat="recentPings in mapObject.allRecentPings track by $index"
                      idkey="'bus-icon' + $index"
                      ng-if="recentPings.isRecent"
                      pings="recentPings.pings"
                      overlay="$index + 1"></map-bus-icon>
      </ui-gmap-google-map>
    </div>
    <div class="item item-text-wrap">
      <div class="service-cancellation" ng-if="disp.tripStatus == 'cancelled'">
        <div class="item item-text-wrap">
          <div class="cancellation-content">
            <h2>Service is Cancelled</h2>
            <img src="img/TicketCancelledTrip.svg" />
            <!-- <i class="icon ion-alert-circled"></i> -->
            <p>Today's trip has been cancelled. Sorry for the inconvenience caused. </p>
            <p>
              Please make alternative transport arrangements.
              <strong>{{company.name}}</strong> will contact you and refund today's fare.
            </p>
            <p>
              For enquiries, please contact
              <strong>{{company.email}}</strong>
              <strong ng-if="company.contactNo">(Tel: {{company.contactNo}})</strong>
            </p>
          </div>
        </div>
      </div>
      <div ng-if="disp.tripStatus !== 'cancelled'">
        <div class="row">
          <route-item hide-bus-label="true" hide-description="true">
            <route-item-start-time>
              {{ ticket.boardStop.time  | formatTime:true }}
            </route-item-start-time>
            <route-item-start-location>
              {{ ticket.boardStop.stop.description }}, {{ticket.boardStop.stop.road}}
            </route-item-start-location>
            <route-item-end-time>
              {{ ticket.alightStop.time  | formatTime:true }}
            </route-item-end-time>
            <route-item-end-location>
              {{ ticket.alightStop.stop.description }}, {{ticket.alightStop.stop.road}}
            </route-item-end-location>
          </route-item>
        </div>
        <div class="row">
          <div class="col col-50">
            <h4>Vehicle</h4>
            <div ng-if="disp.vehicle" class="vehicleNo" ng-bind="disp.vehicle">
            </div>
            <div ng-if="!disp.vehicle">
              Not provided
            </div>
          </div>
          <div class="col">
            <h4>Operated By</h4>
            <!-- <span ng-bind="company.name"></span> -->
            <span class="icon-span company-logo">
              <img class="mini-icon" ng-src="{{route.transportCompanyId | miniCompanyLogo}}">
            </span>
            <span class="mini-info">
              {{company.name}}
            </span>
            <a ng-click="showTerms(company.id)"><i class="icon ion-information-circled tnc"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="trip-code-block" ng-if="disp.tripStatus !== 'cancelled'">
      <h5>Trip Code </h5>
      <div>
        <div ng-if="!tripCode">
          Not available
        </div>
        <div ng-if="tripCode">
          <trip-code class="trip-code" code="tripCode"/>
        </div>
      </div>
    </div>
  </div>
</ion-content>
</ion-modal-view>